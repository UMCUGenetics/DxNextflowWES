params {
    genome = '/hpc/cog_bioinf/GENOMES/Homo_sapiens.GRCh37.GATK.illumina/Homo_sapiens.GRCh37.GATK.illumina.fasta'
}

process {
    errorStrategy = 'finish'

    withLabel: 'FASTQC_0_11_8' {
        cpus = 1
        memory = '1G'
        time = '5m'
        penv = 'threaded'

        publishDir {
            path = "$params.outdir/QC/FastQC"
            mode = 'copy'
        }

        params.fastqc.optional = '--noextract'
    }

    withLabel: 'MIPS_1_0_1_TrimDedup' {
        cpus = 1
        memory = '1G'
        time = '10m'
        penv = 'threaded'

        publishDir {
            path = "$params.outdir/fastqs"
            mode = 'copy'
        }

        params.mips.trim_dedup.path = '/hpc/cog_bioinf/diagnostiek/production/Dx_mips/mips_trim_dedup.py'
        params.mips.trim_dedup.design_file = '/hpc/cog_bioinf/diagnostiek/production/Dx_tracks/fingerprint/81_snp_mips_design.txt'
        params.mips.trim_dedup.uuid_length = 8
        params.mips.trim_dedup.uuid_read = 'R1'

    }

    withLabel: 'BWA_0_7_17_MEM' {
        cpus = 1
        memory = '10G'
        time = '5m'
        penv = 'threaded'

        params.bwa.mem.genome = "$params.genome"
        params.bwa.mem.optional = '-c 100 -M'
    }

    withLabel: 'Sambamba_0_7_0_ViewSort' {
        cpus = 1
        memory = '1G'
        time = '5m'
        penv = 'threaded'

        publishDir {
            path = "$params.outdir/mapping"
            mode = 'copy'
        }
    }

    withLabel: 'GATK_3_8_1_0_gf15c1c3ef_UnifiedGenotyper' {
        cpus = 2
        memory = '1G'
        time = '5m'
        penv = 'threaded'

        publishDir {
            path = "$params.outdir/fingerprint"
            mode = 'copy'
        }

        params.gatk.path = '/hpc/local/CentOS7/cog_bioinf/GenomeAnalysisTK-3.8-1-0-gf15c1c3ef/GenomeAnalysisTK.jar'
        params.gatk.genome = "$params.genome"
        params.gatk.unified_genotyper.optional = '--intervals /hpc/cog_bioinf/diagnostiek/production/Dx_tracks/fingerprint/81SNP_design.vcf --output_mode EMIT_ALL_SITES'
    }

}

report {
    enabled = true
    file = "$params.outdir/log/nextflow_report.html"
}

trace {
    enabled = true
    file = "$params.outdir/log/nextflow_trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
}

timeline {
    enabled = true
    file = "$params.outdir/log/nextflow_timeline.html"   
}

profiles {

    sge {
        process {
            executor = 'sge'
            queue = 'all.q'
            clusterOptions = '-P diaggen'
            errorStrategy = 'finish'
        }

        singularity {
            enabled = true
            runOptions = '-B /hpc:/hpc -B $TMPDIR:$TMPDIR'
            autoMounts = true
        }
    }

    slurm {
        process {
            executor = 'slurm'
            queue = 'cpu'
            errorStrategy = 'finish'
        }

        singularity {
            enabled = true
            runOptions = '-B /hpc:/hpc -B $TMPDIR:$TMPDIR'
            autoMounts = true
            cacheDir = '/hpc/cog_bioinf/diagnostiek/projects/workflow/singularity_cache'
        }

        executor {
            queueSize = 1000
        }
    }

    mac {
        docker.enabled = true
        docker.runOptions = '-v /Users:/Users'
        process.errorStrategy = 'finish'
    }
}
